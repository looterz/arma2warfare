class FSM{fsmName="updateavailableactions";class States{class Init{name="Init";init="_lastUpdate=time;_txt='';_handle=nil;_ftr='WFBE_FASTTRAVELRANGE' Call GetNamespace;_is='WFBE_INCOMESYSTEM' Call GetNamespace;_mhqbr='WFBE_MHQBUILDINGRANGE' Call GetNamespace;_pur='WFBE_PURCHASEUNITSRANGE' Call GetNamespace;_pura='WFBE_PURCHASEUNITSRANGEAIR' Call GetNamespace;_ccr='WFBE_COMMANDCENTERRANGE' Call GetNamespace;_pgr='WFBE_PURCHASEGEARRANGE' Call GetNamespace;_rptr='WFBE_REPAIRTRUCKRANGE' Call GetNamespace;_spr='WFBE_SERVICEPOINTRANGE' Call GetNamespace;_tpr='WFBE_TOWNBUILDPROTECTIONRANGE' Call GetNamespace;_tcr='WFBE_TOWNCAPTURERANGE' Call GetNamespace;_tdr='WFBE_DEFENSEMANRANGE' Call GetNamespace;_fastTravel=false;_commandCenter=objNull;_typeRepair=Format['WFBE_%1REPAIRTRUCKS',sideJoinedText]Call GetNamespace;_sideSupply=Format['%1Supplies',sideJoinedText];12450 cutRsc[""OptionsAvailable"",""PLAIN"",0];_icons=[""ca\ui\data\icon_wf_building_mhq_ca.paa"",""\ca\ui\data\icon_wf_building_barracks_ca.paa"",""\ca\ui\data\icon_wf_building_gear_ca.paa"",""\ca\ui\data\icon_wf_building_lvs_ca.paa"",""\ca\ui\data\icon_wf_building_hvs_ca.paa"",""\ca\ui\data\icon_wf_building_air_ca.paa"",""\ca\ui\data\icon_wf_building_hangar_ca"",""\ca\ui\data\icon_wf_building_repair_ca.paa"",""\ca\ui\data\icon_wf_building_firstaid_ca.paa"",""\ca\ui\data\icon_wf_support_fasttravel_ca.paa"",""Client\Images\icon_wf_building_cc_ca.paa"",""\ca\ui\data\icon_wf_building_aa_radar_ca.paa"",""\ca\ui\data\icon_wf_building_am_radar_ca.paa"",""\ca\ui\data\icon_wf_support_transport_ca.paa"",""\ca\ui\data\icon_wf_support_supplydrop_ca.paa"",""\ca\ui\data\icon_wf_support_artilery_ca.paa"",""\ca\ui\data\icon_wf_support_mortar_ca.paa"",""\ca\ui\data\icon_wf_support_cas_ca.paa"",""\ca\ui\data\icon_wf_support_uav_ca.paa""];_buildings=(sideJoinedText)Call GetSideStructures;_nextUpdate=0;";precondition="";class Links{class Loop{priority=0.000000;to="Update_Client_Ac";precondition="";condition="_nextUpdate<time&&!gameOver";action="";};};};class Update_Client_Ac{name="Update_Client_Ac";init="_buildings=(sideJoinedText)Call GetSideStructures;_base=(sideJoinedText)Call GetSideHQ;_purchaseRange=if(commandInRange)then{_ccr}else{_pur};_nearTown=[player,towns]Call SortByDistance;_closest=_nearTown select 0;if(!isNull(commanderTeam)&&paramHighCommand)then{if(commanderTeam==group player)then{{if!(isNil '_x')then{if!(_x in(hcAllGroups player))then{player HCSetGroup[_x]}}}forEach clientTeams}};if(paramBoundaries)then{_isOnMap=Call BoundariesIsOnMap;if!(_isOnMap&&alive player)then{if!(paramBoundariesRunning)then{_handle=[]Spawn BoundariesHandleOnMap}}else{if!(isNil '_handle')then{terminate _handle;_handle=nil};paramBoundariesRunning=false}};if(visibleMap)then{if(!isNull commanderTeam)then{_txt=format[localize 'STR_WF_Commander',name(leader commanderTeam)]}else{_txt=format[localize 'STR_WF_Commander',localize 'STR_WF_AI']};_txt=_txt+'  '+Format[localize ""STR_WF_Income"",Call GetPlayerFunds,(Call GetIncome)/_is];_txt=_txt+'  '+Format[localize ""STR_WF_IncomeSupply"",(WF_Logic getVariable _sideSupply),sideJoined call GetTotalSupplyValue];(findDisplay 12 displayCtrl 116)ctrlSetText _txt};if!(isNull _base)then{hqInRange=if((player distance _base<_mhqbr)&&(alive _base))then{true}else{false}};barracksInRange=(['BARRACKSTYPE',_buildings,_purchaseRange,sideJoined,player]Call BuildingInRange)select 1;gearInRange=(['BARRACKSTYPE',_buildings,_pgr,sideJoined,player]Call BuildingInRange)select 1;if!(gearInRange)then{_nObjects=nearestObjects[player,WFCAMP,5];_nObject=if(count _nObjects>0)then{_nObjects select 0}else{objNull};if!(isNull _nObject)then{_sideID=_nObject getVariable ""sideID"";if!(isNil '_sideID')then{if(!gearInRange&&sideID==_sideID)then{gearInRange=true}else{gearInRange=false}}}};lightInRange=(['LIGHTTYPE',_buildings,_purchaseRange,sideJoined,player]Call BuildingInRange)select 1;heavyInRange=(['HEAVYTYPE',_buildings,_purchaseRange,sideJoined,player]Call BuildingInRange)select 1;aircraftInRange=(['AIRCRAFTTYPE',_buildings,_purchaseRange,sideJoined,player]Call BuildingInRange)select 1;serviceInRange=(['SERVICEPOINTTYPE',_buildings,_spr,sideJoined,player]Call BuildingInRange)select 1;if!(serviceInRange)then{_checks=(getPos player)nearEntities[_typeRepair,_rptr];if(count _checks>0)then{serviceInRange=true}};if(paramAARadar)then{_checks=[sideJoined,Format[""WFBE_%1AARADARTYPE"",sideJoinedText]Call GetNamespace,_buildings]Call GetFactories;if(count _checks>0)then{antiAirRadarInRange=true}else{antiAirRadarInRange=false}};_nObjects=nearestObjects[player,WFDEPOT,('WFBE_TOWNPURCHASERANGE' Call GetNamespace)];_nObject=if(count _nObjects>0)then{_nObjects select 0}else{objNull};if(!isNull _nObject)then{_sideID=_nObject getVariable ""sideID"";if!(isNil ""_sideID"")then{if(_sideID==sideID)then{if(player distance _nObject<_tcr)then{serviceInRange=true;depotInRange=true}else{depotInRange=false}}}}else{depotInRange=false};_townDefenceRange=false;if(paramBuildDefencesInTown==2||(paramBuildDefencesInTown==1&&(WFBE_SK_V_Type=='Engineer')))then{_nObjects=nearestObjects[player,WFDEPOT,('WFBE_DEFENSEMANRANGE' Call GetNamespace)];_townDepot=if(count _nObjects>0)then{_nObjects select 0}else{objNull};if(!isNull _townDepot)then{_sideID=_townDepot getVariable ""sideID"";if!(isNil ""_sideID"")then{if(_sideID==sideID&&player distance _townDepot<_tdr)then{_timeoutBuildDefencesInTown=_townDepot getVariable ""timeoutBuildDefencesInTown"";if(isNil ""_timeoutBuildDefencesInTown"")then{_timeoutBuildDefencesInTown=0};if(_timeoutBuildDefencesInTown<time)then{_nObjects=player nearEntities[[eastSoldierBaseClass,westSoldierBaseClass,""Car"",""Motorcycle"",""Tank"",""Air""],('WFBE_DEFENSEMANRANGE' Call GetNamespace)];_objs=_nObjects;{if(!(_x isKindOf ""Man""))then{if(count(crew _x)==0)then{_nObjects=_nObjects-[_x]}}}forEach _objs;_hostiles=if(sideJoined==West)then{East countSide _nObjects}else{West countSide _nObjects};if(_hostiles>0)then{_townDepot setVariable[""timeoutBuildDefencesInTown"",(time+300),false]};_townDefenceRange=if(_hostiles==0)then{true}else{false}}}}}};townDefenceRange=_townDefenceRange;_checks=['COMMANDCENTERTYPE',_buildings,_ccr,sideJoined,player]Call BuildingInRange;_commandCenter=_checks select 0;commandInRange=_checks select 1;if(paramHangars)then{_sorted=[player,Airfields]Call SortByDistance;if(count _sorted>0)then{if((_sorted select 0)distance player<_pura&&alive(_sorted select 0))then{hangarInRange=true}else{hangarInRange=false}}else{hangarInRange=false}};if(paramFastTravel&&commandInRange)then{_fastTravel=false;_isDeployed=(sideJoinedText)Call GetSideHQDeployed;if(player distance _base<_ftr&&alive _base&&_isDeployed)then{_fastTravel=true}else{_closest=_nearTown select 0;_sideID=_closest getVariable 'sideID';if(player distance _closest<_ftr&&_sideID==sideID)then{_fastTravel=true}else{if(!isNull _commandCenter)then{if(player distance _commandCenter<_ftr)then{_fastTravel=true}}}}};_usable=[hqInRange,barracksInRange,gearInRange,lightInRange,heavyInRange,aircraftInRange,hangarInRange,serviceInRange,serviceInRange,_fastTravel,commandInRange,antiAirRadarInRange];_c=0;if(isNull([""currentCutDisplay""]call BIS_FNC_GUIget))then{12450 cutRsc[""OptionsAvailable"",""PLAIN"",0]};{if(_x)then{(([""currentCutDisplay""]call BIS_FNC_GUIget)DisplayCtrl(3500+_c))CtrlSetText(_icons select _c)}else{(([""currentCutDisplay""]call BIS_FNC_GUIget)DisplayCtrl(3500+_c))CtrlSetText """"};_c=_c+1}forEach _usable;_nextUpdate=time+2.5;";precondition="";class Links{class Loop{priority=0.000000;to="Update_Client_Ac";precondition="";condition="_nextUpdate<time&&!gameOver";action="";};class Gameover{priority=0.000000;to="End";precondition="";condition="gameOver";action="";};};};class End{name="End";init="";precondition="";class Links{};};};initState="Init";finalStates[]={"End",};};